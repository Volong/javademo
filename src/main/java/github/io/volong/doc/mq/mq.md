##### 17 Kafka、RabbitMQ 以及 RocketMQ 进行技术选型调研

**Kafka的优势和劣势**

- 优势

  Kafka的吞吐量几乎是行业里最优秀的，在常规的机器配置下，一台机器可以达到每秒十几万的QPS。Kafka性能也很高，基本上发送消息给Kafka都是毫秒级的性能。可用性也很高，Kafka是可以支持集群部署的，其中部分机器宕机是可以继续运行的。

- 劣势

  Kafka收到消息之后会写入一个磁盘缓冲区里，并没有直接落地到物理磁盘上去，所以要是机器本身故障了，可能会导致磁盘缓冲区里的数据丢失。

  功能非常的单一，主要是支持收发消息。

Kafka一般用在用户行为日志的采集和传输上，因为日志适当丢失数据是没有关系的，而且一般量特别大，要求吞吐量要高，一般就是收发消息，不需要太多的高级功能。

**RabbitMQ的优势和劣势**

- 优势

  可以保证数据不丢失，也能保证高可用性，即集群部署的时候部分机器宕机可以继续运行，然后支持部分高级功能，比如说死信队列，消息重试。
  
- 缺点

  吞吐量比较低，一般就是每秒几万的级别，所以如果遇到特别特别高并发的情况下，支撑起来是有点困难的。

  在进行集群扩展的时候比较麻烦。

  开发语言是erlang，国内很少有精通erlang语言的工程师，因此也没办法去阅读他的源代码，甚至修改他的源代码。

**RocketMQ的优势和劣势**

- 优势

  吞吐量很高，单机可以达到10万QPS以上，而且可以保证高可用性，性能很高，而且支持通过配置保证数据绝对不丢失，可以部署大规模的集群，还支持各种高级的功能，比如说延迟消息、事务消息、消息回溯、死信队列、消息积压，等等。

  基于Java开发，符合国内大多数公司的技术栈。

- 劣势

  文档相对简单

##### 21 消息中间件路由中心的架构原理是什么

`NameServer`可以进行集群化部署。每个`Broker`启动时向所有的`NameServer`进行注册。

生产者和消费者会主动去`NameServer`获取`Broker`的路由信息，通过这些信息，每个系统可以知道发送或者获取消息去哪个`Broker`节点。

`Broker`每隔`30s`会给所有的`NameServer`发送心跳，`NameServer`收到一个`Broker`的心跳，就会更新它的心跳时间。
`NameServer`每隔`10s`会运行一个任务，去检查每个`Broker`的心跳时间，如果某个`Broker`超过`120s`都没有发送心跳，就认为这个`Broker`已经挂掉了。

##### 23 Broker的主从架构原理是什么

