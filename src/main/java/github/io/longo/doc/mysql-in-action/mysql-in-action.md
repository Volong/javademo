> [从零开始带你成为MySQL实战优化高手](https://apppukyptrl1086.pc.xiaoe-tech.com/detail/p_5e0c2a35dbbc9_MNDGDYba/6)



##### 03 通过更新语句初步了解InnoDB存储引擎的架构设计

- InnoDB存储引擎中缓存池的作用

  InnoDB在更新数据时，会先看这条数据是否在缓存池（Buffer Pool）中，如果不在的话，会先从磁盘中加载到缓冲池里，还会对这条记录加独占锁

- undo日志如何进行回滚

  更新数据时，在事务提交之前会先将原来的旧值写入到`undo`日志中，这样在事务提交前可以对数据进行回滚

更新数据的流程：

- 先看这条数据是否在缓冲池（Buffer Pool）中，不在的话，会从磁盘加载到缓冲池中来，而且还会对这条记录加独占锁

- 将原来的旧值写入到`undo`日志中，这样在事务提交前可以对数据进行回滚

- 先更新缓冲池中的数据，那么这条数据就变成了脏数据

- 把对内存中所做的修改写入到`Redo Log Buffer`中

  > 这是`redo`日志的缓冲区

> 如果这时事物还没有提交，MySQL宕机了，内存里面的数据都会丢失。
>
> 但是由于没有提交事务，所以并不会有任何问题

- 提交事务的时候将`redo`日志写入磁盘中

  会根据以下策略将`redo`日志从`Redo Log Buffer`中刷到磁盘文件中。

  > 具体的策略是通过`innodb_flush_log_at_trx_commit`来配置的

  - **0**

    提交事务时不会将`redo log buffer`里的数据刷入磁盘文件，如果mysql宕机了，此时内存里的数据全部会丢失

  - **1**

    提交事务时，必须把`redo log`从内存中刷到磁盘文件，只要事物提交成功了，那么`redo log`就一定在磁盘中了

  - **2**

    提交事务时，把`redo`日志写入磁盘文件对应的`os cache`中，然后过段时间再写入磁盘文件

  







